{% extends 'base/base.html' %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'accommodation/accommodation_filter.css' %}">
    <link rel="stylesheet" href="{% static 'accommodation/accommodation_location.css' %}">
    <script async defer 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZLQne-DOUQDfifh3ZP_79TmL2OmBOI7k&libraries=places&loading=async">
    </script>
    <script>
        window.addEventListener('load', function() {
            if (google && google.maps) {
                initMap();
            } else {
                console.error('Google Maps API not loaded');
            }
        });
    </script>
    <script defer src="{% static 'accommodation/accommodation_map_list.js' %}"></script>
{% endblock %}

{% block content %}
<div class="accommodation-container">
    <h1 class="title">다음 여행자를 위한 작은 안내서, <span class="highlight">숙소 후기</span></h1>
    
    <div class="search-section">
        <form class="search-box" method="GET" action="{% url 'accommodation:filter' %}">
            <input type="text" name="city" placeholder="여행지 검색" class="location-input" value="{{ city_query }}">
            <div class="divider"></div>
            <input type="number" name="rating" placeholder="이용자 평점" class="facility-input" 
                   min="0" max="5" step="0.5" value="{{ rating_query }}">
            <button type="submit" class="search-btn">
                <img src="{% static 'img/search-icon.svg' %}" alt="검색">
            </button>
        </form>
        <button onclick="window.location.href='{% url 'accommodation:accommodation_create' %}'">숙소 등록하기</button>
    </div>

    <section class="main_accommodation"  style="display: none;">
        <div class="main_accommodation_container">
            <div class="main_accommodation_left">
                <h2>방문했던 숙소의 솔직한 후기를 공유해주세요!</h2>
                <img src="{% static 'img/main_hotel_review.svg' %}" alt="accommodation review">
                <a class="main_review_btn" href="{% url 'accommodation:accommodation_create' %}">직접 후기 추가하기</a>
            </div>
            <div class="main_accommodation_right">
                <span class="main_tag">#치안</span>
                <span class="main_tag">#친절</span>
                <span class="main_tag">#와이파이</span>
                <span class="main_tag">#에어컨</span>
                <span class="main_tag">#접근성</span>
                <span class="main_tag">#청결도</span>
                <span class="main_tag">#소음</span>
                <span class="main_tag">#가격</span>
            </div>
        </div>
    </section>

    <div class="location-container">
        <div class="accommodation-list">
            {% for review in reviews %}
            <div class="accommodation-card" 
                 data-title="{{ review.accommodation_name }}" 
                 data-city="{{ review.city }}" 
                 data-review-id="{{ review.review_id }}">
                <div class="card-left">
                    <div class="hotel-image">
                        <img id="place-img-{{ review.review_id }}" 
                            src="{% static 'img/room_ex1.png' %}" 
                            alt="숙소 이미지">
                        <div class="rating">
                            {% for i in "12345"|make_list %}
                                {% if forloop.counter <= review.rating %}
                                    <img src="{% static 'img/fill_star.png' %}" alt="별점">
                                {% else %}
                                    <img src="{% static 'img/empty_star.png' %}" alt="별점">
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="hotel-info">
                        <div class="hotel-title">{{ review.accommodation_name }}</div>
                        <div class="hotel-address">{{ review.city }}</div>
                        <p class="review-content">{{ review.content }}</p>
                    </div>
                    <a href="{% url 'accommodation:accommodation_review_detail' review.review_id %}" 
                       class="view-review-btn">
                        후기 보기
                    </a>
                </div>
            </div>
            {% endfor %}        
        </div>
        
        <div class="map-section">
            <input id="search-bar" type="text" placeholder="장소를 검색하세요">
            <div id="map">
            </div>
        </div>
    </div>
</div>
{% endblock %}
{%block js%}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const accommodationList = document.querySelector('.accommodation-list');
        const mainAccommodation = document.querySelector('.main_accommodation');
        const mapSection = document.querySelector('.map-section');

        if (accommodationList.children.length === 0) {
            mainAccommodation.style.display = 'block';
            mapSection.style.display = 'none';
        } else {
            mainAccommodation.style.display = 'none';
            mapSection.style.display = 'block';
        }
    });
</script>
{%endblock js%}
